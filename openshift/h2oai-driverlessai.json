{
  "apiVersion": "v1",
  "items": [
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "labels": {
          "app": "h2oai-driverlessai"
        },
        "name": "h2oai-driverlessai",
        "namespace": "h2o"
      },
      "spec": {
        "ports": [
          {
            "port": 12345,
            "protocol": "TCP",
            "targetPort": 12345
          }
        ],
        "selector": {
          "app": "h2oai-driverlessai"
        }
      }
    },
    {
      "apiVersion": "extensions/v1beta1",
      "kind": "Deployment",
      "metadata": {
        "labels": {
          "app": "h2oai-driverlessai"
        },
        "name": "h2oai-driverlessai",
        "namespace": "h2o"
      },
      "spec": {
        "strategy": {
          "rollingUpdate": {
            "maxSurge": 1,
            "maxUnavailable": 1
          },
          "type": "RollingUpdate"
        },
        "template": {
          "metadata": {
            "labels": {
              "app": "h2oai-driverlessai"
            }
          },
          "spec": {
            "containers": [
              {
                "args": [
                  "-c",
                  "$(DAI_START_COMMAND)"
                ],
                "command": [
                  "/bin/bash"
                ],
                "env": [
                  {
                    "name": "DAI_START_COMMAND",
                    "value": "if nvidia-smi | grep -o failed || true; then ./run.sh; else nvidia-smi -pm 1 \u0026\u0026 ./run.sh; fi"
                  },
                  {
                    "name": "DRIVERLESS_AI_CONFIG_FILE",
                    "value": "/config/config.toml"
                  },
                  {
                    "name": "DRIVERLESS_AI_LICENSE_FILE",
                    "value": "/config/license.sig"
                  }
                ],
                "image": "quay.io/pdmack/h2oai-driverless-ai:1.5.4-cuda9.0",
                "imagePullPolicy": "IfNotPresent",
                "name": "h2oai-driverlessai",
                "ports": [
                  {
                    "containerPort": 12345,
                    "protocol": "TCP"
                  }
                ],
                "resources": {
                  "limits": {
                    "cpu": "4",
                    "memory": "16Gi",
                    "nvidia.com/gpu": 0
                  },
                  "requests": {
                    "cpu": "4",
                    "memory": "16Gi",
                    "nvidia.com/gpu": 0
                  }
                },
                "securityContext": {
                  "privileged": true
                },
                "volumeMounts": [
                  {
                    "mountPath": "/tmp",
                    "name": "h2oai-driverlessai-pvc"
                  },
                  {
                    "mountPath": "/log",
                    "name": "h2oai-driverlessai-pvc"
                  },
                  {
                    "mountPath": "/config",
                    "name": "dai-configmap-driverless"
                  }
                ]
              }
            ],
            "dnsPolicy": "ClusterFirst",
            "restartPolicy": "Always",
            "schedulerName": "default-scheduler",
            "volumes": [
              {
                "name": "h2oai-driverlessai-pvc",
                "persistentVolumeClaim": {
                  "claimName": "h2oai-driverlessai"
                }
              },
              {
                "configMap": {
                  "name": "driverless"
                },
                "name": "dai-configmap-driverless"
              }
            ]
          }
        }
      }
    }
  ],
  "kind": "List"
}
